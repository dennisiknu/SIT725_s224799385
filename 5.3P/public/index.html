<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Books Catalogue</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 16px;
        }

        #list .item {
            cursor: pointer;
            padding: 6px;
            border: 1px solid #ddd;
            margin: 6px 0;
        }

        #list .item:hover {
            background: #f2f2f2;
        }

        #details {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 12px;
        }

        .label {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h2>Books catalogue developed by S224799385</h2>
    <p>Click the button to get all book from the server</p>
    <button id="btn">Get all books</button>

    <h3>Books</h3>
    <div id="list">No books loaded yet.</div>

    <h3>Selected book details</h3>
    <div id="details">Click a book to view details.</div>

    <script>
        const btn = document.getElementById('btn');
        const listEl = document.getElementById('list');
        const detailsEl = document.getElementById('details');

        function priceToString(book) {
            if (book.priceAUD && book.priceAUD.$numberDecimal)
                return book.priceAUD.$numberDecimal;
        }

        function renderList(books) {
            listEl.innerHTML = '';
            detailsEl.textContent = 'Click a book to view details.';

            if (!Array.isArray(books) || books.length === 0) {
                listEl.textContent = 'No books found.';
                return;
            }

            books.forEach((b) => {
                const div = document.createElement('div');
                div.className = 'item';
                div.textContent = `${b.title} - ${priceToString(b)} AUD`;
                div.dataset.id = b.id;
                div.addEventListener('click', () => loadDetails(div.dataset.id));
                listEl.appendChild(div);
            });
        }

        function renderDetails(b) {
            detailsEl.innerHTML = `
        <p><span class="label">ID:</span> ${b.id}</p>
        <p><span class="label">Title:</span> ${b.title}</p>
        <p><span class="label">Author:</span> ${b.author}</p>
        <p><span class="label">Year:</span> ${b.year}</p>
        <p><span class="label">Genre:</span> ${b.genre}</p>
        <p><span class="label">Summary:</span> ${b.summary}</p>
        <p><span class="label">Price (AUD):</span> ${priceToString(b)}</p>
      `;
        }

        async function loadList() {
            listEl.textContent = 'Loading...';
            detailsEl.textContent = 'Click a book to view details.';

            try {
                const res = await fetch('/api/books');
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const body = await res.json();
                renderList(body.data);
            } catch (err) {
                console.error(err);
                listEl.textContent = 'Error loading books.';
            }
        }

        async function loadDetails(id) {
            detailsEl.textContent = 'Loading details...';

            try {
                const res = await fetch(`/api/books/${id}`);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const body = await res.json();

                if (!body.data) {
                    detailsEl.textContent = 'Book not found.';
                    return;
                }

                renderDetails(body.data);
            } catch (err) {
                console.error(err);
                detailsEl.textContent = 'Error loading book details.';
            }
        }

        btn.addEventListener('click', loadList);
    </script>
</body>

</html>